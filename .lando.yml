name: d9-upgrade-status
recipe: drupal8
config:
  php: '7.2'
  via: apache:2.4
  webroot: drupal/web
  database: mysql:5.7
  drush: ^8
  xdebug: false

services:
  appserver:
    build:
      - "cd /app/drupal && chmod u+w web/sites/default"
      - "cd /app/drupal && COMPOSER_PROCESS_TIMEOUT=600 composer install"
      - "cd /app/drupal && chmod u+w web/sites/default"

tooling:
  drush:
    service: appserver
    cmd: /app/drupal/vendor/bin/drush --root=/app/drupal/web

  check:
    service: appserver
    description: Run D9 Upgrade Status Check against your csv
    cmd:
      - 'git checkout master'
      - 'chmod u+w web/sites/default'
      - '/app/drupal/vendor/bin/drush pm:enable upgrade_status -y'
      - '/app/d9upgrade_statuscheckall.sh'

  clean:
    service: appserver
    description: Run D9 Upgrade Status Check against your csv
    cmd:
      - 'git checkout master; git branch | grep -v "master" | xargs git branch -D'
      - 'git reset --hard HEAD'
